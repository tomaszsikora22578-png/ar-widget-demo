<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tester Wdrożenia Cloud Run (Frontend)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
    </style>
</head>
<body class="p-8">

<div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-6 md:p-10">
    <h1 class="text-3xl font-bold text-gray-800 mb-4 border-b pb-2">Cloud Run Backend Tester</h1>
    <p class="text-gray-600 mb-6">
        Poniższy interfejs próbuje pobrać dane z Twojego wdrożonego API C# na Cloud Run.
        <br>
        Adres URL API: <code id="api-url-display" class="bg-gray-200 p-1 rounded-md text-sm"></code>
        <br>
        <span id="token-display" class="font-bold text-indigo-700"></span>
    </p>

    <button id="fetch-button" 
            class="w-full md:w-auto px-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl shadow-md hover:bg-indigo-700 transition duration-150 transform hover:scale-[1.02]">
        Testuj Połączenie i Pobierz Dane
    </button>

    <div id="api-status" class="mt-6 p-4 rounded-lg font-medium text-blue-500 bg-blue-50">
        Wciśnij przycisk, aby rozpocząć test.
    </div>
    
    <div id="api-result" class="mt-6 border-t pt-4">
        <!-- Tutaj zostaną wyświetlone wyniki JSON -->
    </div>
</div>

<!-- Ładowanie pliku z tokenem i URL -->
<script src="./ar-widget.js"></script>

<!-- Twój dotychczasowy skrypt korzystający z tych zmiennych -->
<script>
async function fetchWidgets() {
    const resultDiv = document.getElementById('api-result');
    const statusDiv = document.getElementById('api-status');

    statusDiv.textContent = 'Ładowanie danych z API...';
    statusDiv.className = 'mt-6 p-4 rounded-lg font-medium text-blue-500 bg-blue-50';
    resultDiv.innerHTML = '';

    try {
        const headers = new Headers();
        headers.append('Authorization', `Bearer ${DEMO_TOKEN}`);

        const response = await fetch(API_URL, { method: 'GET', headers });

        if (!response.ok) {
            const errorText = await response.text();
            statusDiv.textContent = `BŁĄD: ${response.status} (${response.statusText})`;
            statusDiv.className = 'mt-6 p-4 rounded-lg font-medium text-red-700 bg-red-100';
            resultDiv.innerHTML = `<h3 class="font-semibold text-red-700 mb-2">Treść błędu:</h3>
                                   <pre class="bg-red-50 p-4 rounded-lg text-sm whitespace-pre-wrap">${errorText}</pre>`;
            return;
        }

        const data = await response.json();
        statusDiv.textContent = '✅ SUKCES! Dane JSON otrzymane z Cloud Run (autoryzacja przyjęta).';
        statusDiv.className = 'mt-6 p-4 rounded-lg font-medium text-green-700 bg-green-100';
        resultDiv.innerHTML = `<h3 class="text-lg font-semibold mb-2">Odebrane dane:</h3>
                               <pre class="bg-gray-100 p-4 rounded-lg text-sm whitespace-pre-wrap">${JSON.stringify(data, null, 2)}</pre>`;
    } catch (error) {
        statusDiv.textContent = `BŁĄD SIECI/CORS: ${error.message}`;
        statusDiv.className = 'mt-6 p-4 rounded-lg font-medium text-red-700 bg-red-100';
        resultDiv.innerHTML = `<p class="text-red-600 mt-2">Sprawdź konsolę przeglądarki.</p>`;
        console.error('Szczegóły błędu:', error);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('api-url-display').textContent = API_URL;
    document.getElementById('token-display').textContent = `Wysyłany token: Bearer ${DEMO_TOKEN}`;
    document.getElementById('fetch-button').addEventListener('click', fetchWidgets);
    fetchWidgets();
});
</script>

</body>
</html>
