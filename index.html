<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tester Wdrożenia Cloud Run (Frontend)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
    </style>
    <script>
        // UWAGA: Zmienna API_URL wskazuje na Twój wdrożony serwis Cloud Run
        const API_URL = 'https://ar-widget-api-849496305543.europe-central2.run.app/api/widget';
        
        // TOKEN TESTOWY DLA API (Wprowadzony przez Ciebie)
        const DEMO_TOKEN = 'TEST_TOKEN_XYZ'; 

        // Funkcja do pobierania danych z API
        async function fetchWidgets() {
            const resultDiv = document.getElementById('api-result');
            const statusDiv = document.getElementById('api-status');

            statusDiv.textContent = 'Ładowanie danych z API...';
            statusDiv.classList.remove('text-red-500', 'text-green-500', 'text-yellow-500');
            statusDiv.classList.add('text-blue-500');
            resultDiv.innerHTML = '';

            try {
                const headers = new Headers();
                // WYSYŁANIE NAGŁÓWKA AUTORYZACJI
                headers.append('Authorization', `Bearer ${DEMO_TOKEN}`); 

                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: headers
                });

                if (!response.ok) {
                    // Jeśli API zwróci np. 401 (Unauthorized) lub 404
                    statusDiv.textContent = `BŁĄD: Otrzymano status ${response.status} (${response.statusText}). Wysłany token testowy (${DEMO_TOKEN}) nie został zaakceptowany.`;
                    statusDiv.classList.replace('text-blue-500', 'text-red-500');
                    
                    // Spróbuj pobrać treść jako tekst, jeśli API zwróci komunikat błędu
                    const errorText = await response.text();
                    resultDiv.innerHTML = `<pre class="bg-red-100 p-4 rounded-lg text-sm whitespace-pre-wrap">${errorText}</pre>`;
                    return;
                }

                const data = await response.json();
                
                statusDiv.textContent = 'SUKCES! Dane JSON otrzymane z Cloud Run (Autoryzacja przyjęta).';
                statusDiv.classList.replace('text-blue-500', 'text-green-500');

                // Wyświetlanie sformatowanego JSON-a
                resultDiv.innerHTML = `
                    <h3 class="text-lg font-semibold mb-2">Odebrane dane:</h3>
                    <pre class="bg-gray-100 p-4 rounded-lg text-sm whitespace-pre-wrap">${JSON.stringify(data, null, 2)}</pre>
                `;

            } catch (error) {
                // Błąd sieciowy (np. CORS, brak serwera)
                statusDiv.textContent = `BŁĄD SIECI: Wystąpił problem z połączeniem z serwerem. Sprawdź, czy adres jest poprawny i czy Cloud Run jest dostępny publicznie.`;
                statusDiv.classList.replace('text-blue-500', 'text-red-500');
                resultDiv.innerHTML = `<p class="text-red-600 mt-2">Szczegóły błędu: ${error.message}</p>`;
            }
        }
        
        // Zapewnienie, że funkcja fetchWidgets jest wywołana tylko po załadowaniu DOM
        document.addEventListener('DOMContentLoaded', () => {
             const button = document.getElementById('fetch-button');
             if(button) {
                button.addEventListener('click', fetchWidgets);
             }
             // Automatyczne wywołanie przy starcie (opcjonalne, ale pomocne w testach)
             fetchWidgets();
        });
    </script>
</head>
<body class="p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-6 md:p-10">
        <h1 class="text-3xl font-bold text-gray-800 mb-4 border-b pb-2">Cloud Run Backend Tester</h1>
        <p class="text-gray-600 mb-6">
            Poniższy interfejs próbuje pobrać dane z Twojego wdrożonego API C# na Cloud Run. 
            Adres URL API: <code class="bg-gray-200 p-1 rounded-md text-sm">${API_URL}</code>
            <br>
            <span class="font-bold text-indigo-700">Wysyłany token: Bearer ${DEMO_TOKEN}</span>
        </p>

        <button id="fetch-button" 
                class="w-full md:w-auto px-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl shadow-md hover:bg-indigo-700 transition duration-150 transform hover:scale-[1.02]">
            Testuj Połączenie i Pobierz Dane
        </button>

        <div id="api-status" class="mt-6 p-4 rounded-lg font-medium text-blue-500 bg-blue-50">
            Wciśnij przycisk, aby rozpocząć test.
        </div>
        
        <div id="api-result" class="mt-6 border-t pt-4">
            </div>

    </div>
</body>
</html>
